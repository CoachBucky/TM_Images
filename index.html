<!DOCTYPE html>
<html>
<head>
    <title>My Teachable Machine Model</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding-top: 20px;
            background-color: #f0f2f5;
        }
        h1 {
            color: #333;
        }
        #container {
            display: flex;
            flex-direction: row;
            gap: 20px;
        }
        #webcam-container {
            border: 2px solid #ccc;
            border-radius: 8px;
            overflow: hidden; /* This keeps the webcam feed inside the rounded corners */
        }
        #label-container {
            width: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 10px;
        }
        .prediction-row {
            display: flex;
            align-items: center;
            width: 100%;
        }
        .prediction-label {
            width: 80px; /* Adjust as needed for your class name length */
            margin-right: 10px;
            font-weight: bold;
            color: #555;
        }
        .bar-container {
            flex-grow: 1;
            height: 25px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            width: 0%; /* Start with 0 width */
            background-color: #4caf50; /* A default color */
            border-radius: 5px;
            transition: width 0.1s ease-in-out; /* Smooth transition for the bar */
        }
        /* Specific colors for your classes (optional, but nice!) */
        .prediction-row:nth-child(1) .bar-fill {
            background-color: #ff9800; /* First bar will be orange */
        }
        .prediction-row:nth-child(2) .bar-fill {
            background-color: #e91e63; /* Second bar will be pink */
        }
    </style>
</head>
<body>
    <h1>My Live AI Model</h1>
    <div id="container">
        <div id="webcam-container"></div>
        <div id="label-container"></div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.3.1/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@0.8/dist/teachablemachine-image.min.js"></script>
    <script type="text/javascript">
        const URL = "./"; // This tells it to look for model files in the same folder

        let model, webcam, labelContainer, maxPredictions;

        // Load the image model and setup the webcam
        async function init() {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();

            const flip = true; 
            webcam = new tmImage.Webcam(300, 300, flip); // Adjusted size
            await webcam.setup();
            await webcam.play();
            window.requestAnimationFrame(loop);

            // Append the webcam canvas to the container
            document.getElementById("webcam-container").appendChild(webcam.canvas);
            
            // Get the container for labels
            labelContainer = document.getElementById("label-container");

            // *** MODIFIED PART: Create the HTML for the prediction bars ***
            for (let i = 0; i < maxPredictions; i++) {
                // Create a container for the class label and the bar
                const row = document.createElement("div");
                row.classList.add("prediction-row");

                // Create and add the class label
                const label = document.createElement("div");
                label.classList.add("prediction-label");
                label.innerHTML = model.getClassLabels()[i]; // Get class name from model
                row.appendChild(label);

                // Create the container for the bar
                const barContainer = document.createElement("div");
                barContainer.classList.add("bar-container");

                // Create the actual bar that will be filled
                const barFill = document.createElement("div");
                barFill.classList.add("bar-fill");
                barContainer.appendChild(barFill);

                row.appendChild(barContainer);
                labelContainer.appendChild(row);
            }
        }

        async function loop() {
            webcam.update();
            await predict();
            window.requestAnimationFrame(loop);
        }

        // Run the webcam image through the image model
        async function predict() {
            const prediction = await model.predict(webcam.canvas);

            // *** MODIFIED PART: Update the bar widths ***
            for (let i = 0; i < maxPredictions; i++) {
                const probability = prediction[i].probability;
                // Find the bar fill element for the current class
                const barFill = labelContainer.getElementsByClassName("bar-fill")[i];
                // Set its width based on the probability
                barFill.style.width = (probability * 100) + "%";
            }
        }
        
        // Start the process
        init();
    </script>
</body>
</html>
